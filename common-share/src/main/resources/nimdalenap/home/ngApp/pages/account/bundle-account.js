angular.module("emixApp.controllers").controller("login_index",["$http","$scope","$rootScope","httpServices","sharedInfo","$cookies","$location","$translate","$interval","$timeout","authService","shareFunc",function(e,t,n,s,r,o,a,i,l,c,d,u){"use strict";NProgress.done(),$.unblockUI(),t.title=new Date,t.userName="",t.password="",t.showError=!1;t.loginFormStatus="init",t.Timer=null;var m=function(){t.sendOtpButtonText=i.instant("login.sendOtp"),t.sendOtpButtonDisabled=!1,t.sendOtpButtonDisableTime=120};c(m(),100),t.nextFocus=function(e){document.getElementById(e).focus()},t.sendOtpCode=function(){if("password"!==t.loginFormStatus&&"otpPassword"!==t.loginFormStatus||t.password&&0!=t.password.trim().length){var e={userName:t.userName,password:t.password};t.send2faCode(e)}else toastr.error(i.instant("validate.requiredMessage",{element:i.instant("common.password")}))};var f=function(){t.sendOtpButtonDisableTime-=1,t.sendOtpButtonText=i.instant("login.sendOtp")+" "+t.sendOtpButtonDisableTime,t.sendOtpButtonDisableTime<=0&&(m(),angular.isDefined(t.Timer)&&l.cancel(t.Timer))};t.send2faCode=function(e){if(!t.myForm.$valid&&!e)return t.showError=!0,void toastr.error(i.instant("common.completeFormCarefully"));e||(e={userName:t.userName}),NProgress.start(),$.blockUI(),s.send2faCode(e).then(function(e){t.showError=!1,"uniqueCode"!=e.data.returnObject.status&&(t.loginFormStatus=e.data.returnObject.status,"sendverificationcode"!==t.loginFormStatus.toLowerCase()?(t.password="",c(function(){$("#password").focus()},500)):(toastr.success(e.data.returnObject.message),c(function(){$("#otp").focus()},500),function(e){if(e){var n=parseInt(e.remainTime,10);t.sendOtpButtonDisabled=n>0,t.sendOtpButtonDisableTime=n}}(e.data.returnObject),f(),angular.isDefined(t.Timer)&&l.cancel(t.Timer),t.Timer=l(function(){f()},1e3)))},function(e){s.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()})},t.login=function(){t.showError=!0,t.myForm.$valid?(NProgress.start(),$.blockUI(),s.login(t.userName,t.password,t.otp,"","","").then(function(e){var t=e.data;r.saveUserData(t.name+" "+t.family),r.saveUserId(t.userId),r.saveUserLogoPath(t.logoPath),d.setRefreshToken(t.refresh_token),d.setTokenInStorage(t.access_token),g()},function(e){s.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()})):toastr.error(i.instant("common.completeFormCarefully"))},t.backToUserName=function(){t.loginFormStatus="init",c(function(){$("#userName").focus()},500)},u.hideMenu();var g=function(){"admin"===s.getPanelType()?p():h()},p=function(){s.redirect(Emix.Pages.dashboard),u.showMenu()},h=function(){var e=$("div.navbar-login-box"),t="",n="";"advertise"===s.getProjectType()&&(n=((t=a.absUrl().split("/")[3]).length>0?"/":"")+t+Emix.Pages.sitePanelPage),n=e.length>0?(t.length>0?"/":"")+t+Emix.Pages.sitePanelPage:t+Emix.Pages.dashboard,s.redirect(n),u.showMenu(),window.location.reload()};s.checkIsLogin(function(){g()}),t.registershow=function(){s.registershow()}}]),angular.module("emixApp.controllers").controller("logout_index",["$scope","httpServices","$location","$timeout","authService",function(e,t,n,s,r){"use strict";e.logout=function(){NProgress.start(),$.blockUI(),t.logout().then(function(e){e.data;if(r.clearAllToken(),$("div.navbar-login-box").length>0&&"advertise"===t.getProjectType()){var o=n.absUrl().split("/")[3];t.redirect("/"+o+Emix.Pages.sitePanelPage)}else t.redirect(Emix.Pages.login);"panel"===t.getPanelType()&&s(function(){window.location.reload()},500)},function(e){t.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()})},e.logout()}]),angular.module("emixApp.controllers").controller("profile_index",["$scope","httpServices","$rootScope","sharedInfo","$translate","$routeParams","shareFunc",function(e,t,n,s,r,o,a){"use strict";e.userId=o.userId,e.userPic=Emix.Api.Account.image+"/u/"+e.userId+"?v="+Date.now(),void 0===jQuery.cookie("accessToken")&&"skin-blue ng-scope"===$("body").attr("class")||(jQuery(".sidebar-toggle").show(),jQuery(".navbar-custom-menu").show()),e.loginTypeList=s.getLoginType(),e.result="",e.params={},e.userRoles={selected:[]},NProgress.start(),$.blockUI(),t.getAllRoles().then(function(t){var n=t.data;e.allRoles=n.returnObject,e.getUserInfoById()},function(e){t.handleError(e.data,e.status,e.headers,e.config),NProgress.done(),$.unblockUI()}).finally(function(){}),e.getUserInfoById=function(){t.getUserInfoById(e.userId).then(function(n){var s=n.data;e.result=s.returnObject,e.userRoles.selected=e.result.roles.map(function(e){return e.id}),t.getAccountInfoByUserId(e.userId).then(function(t){var n=t.data;e.params.accounts=[n.returnObject]},function(e){t.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()})},function(e){t.handleError(e.data,e.status,e.headers,e.config),NProgress.done(),$.unblockUI()}).finally(function(){})},e.editFull=function(){if(e.showError=!0,e.myForm.$valid){NProgress.start(),$.blockUI();var o={id:e.result.id,firstName:e.result.firstName,lastName:e.result.lastName,mobileNumber:e.result.mobileNumber,email:e.result.email,address:e.result.address,gender:e.result.gender,sendNotify:e.result.sendNotify,sendSms:e.result.sendSms,sendEmail:e.result.sendEmail,affiliateReagent:e.result.affiliateReagent,roles:e.userRoles.selected,enable:e.result.enabled,expireDate:e.result.expireDate,loginType:e.result.loginType,limitIpList:e.result.limitIpList};t.editFull(o).then(function(t){t.data;toastr.success(r.instant("common.successfullySavedMessage")),s.saveUserData(e.result.firstName+" "+e.result.lastName),n.$emit("CallUpdateInfo",{})},function(e){t.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()})}},e.lockUser=function(){NProgress.start(),$.blockUI(),t.lockUser(e.result.id).then(function(t){t.data;toastr.success(r.instant("common.successfullyActionMessage")),e.getUserInfoById()},function(e){t.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()})},e.unlockUser=function(){NProgress.start(),$.blockUI(),t.unlockUser(e.result.id).then(function(t){t.data;toastr.success(r.instant("common.successfullyActionMessage")),e.getUserInfoById()},function(e){t.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()})},e.resetUserPassword=function(){NProgress.start(),$.blockUI(),t.resetUserPassword(e.result.id).then(function(e){var t=e.data;toastr.success(t.message)},function(e){t.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()})},e.showLimitIpError=!1,e.limitIp="",e.validateIp=!0,e.addLimitIp=function(){if(e.showLimitIpError=!0,e.limitIp&&(e.validateIp=a.validateIp(e.limitIp),e.validateIp)){if(e.result.limitIpList.indexOf(e.limitIp)>=0)return void toastr.error(r.instant("common.duplicateElement2",{element:r.instant("common.value")}));e.result.limitIpList.push(e.limitIp),e.showLimitIpError=!1,e.validateIp=!0,e.limitIp=""}},e.removeLimitIp=function(t){var n=e.result.limitIpList.indexOf(t);e.result.limitIpList.splice(n,1)},e.maxImageUploadCount=1,e.storeLogoList=[],e.selectImage=function(){var t={formData:{id:e.userId},ratioWidth:200,ratioHeight:200,uploadUrl:Emix.Api.Profile.uploadProfileImage};a.openModal(t,"/nimdalenap/home/ngApp/pages/application/common/image/index.html","selectimage_index","md",function(t){e.userPic=Emix.Api.Account.image+"/u/"+e.userId+"?v="+Date.now()},function(){})}}]),angular.module("emixApp.controllers").controller("change_password_index",["$scope","httpServices","$routeParams","$translate","$timeout","shareFunc",function(e,t,n,s,r,o){"use strict";e.isReset="1"===n.isreset,t.getToken().then(function(e){o.showMenu()},function(e){405===e.status&&o.hideMenu()}),e.changePassword=function(){if(e.showError=!0,e.myForm.$valid)if(e.password===e.confirmPassword){NProgress.start(),$.blockUI();var n=void 0==e.oldpassword?"":e.oldpassword,o={newPassword:e.password,confirmNewPassword:e.confirmPassword,oldPassword:n};t.changePassword(o).then(function(n){n.data;toastr.success(s.instant("common.successfullySavedMessage")),e.password="",e.oldpassword="",e.confirmPassword="",e.showError=!1,t.redirectWithDelay(Emix.Pages.changePassword,100),r(function(){location.reload()},1e3)},function(e){t.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()})}else toastr.error(s.instant("login.dontMatch"));else toastr.error(s.instant("common.completeFormCarefully"))},e.checkPassword=function(){e.myForm.confirmPassword.$error.dontMatch=e.password!==e.confirmPassword}}]),angular.module("emixApp.controllers").controller("rolelist_index",["$scope","httpServices","PagerService","$rootScope","shareFunc","sharedInfo","$translate",function(e,t,n,s,r,o,a){"use strict";function i(){NProgress.start(),$.blockUI(),t.getAllRoles().then(function(t){var n=t.data;e.dtData=n.returnObject},function(e){t.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()})}i(),e.editRole=function(e){var t={roleId:e};r.openModal(t,"/nimdalenap/home/ngApp/pages/account/role/edit.html","editrole_index",null,function(e){o.getNeedRefresh()&&i()},function(){o.getNeedRefresh()&&i()})},e.deleteRole=function(e){NProgress.start(),$.blockUI(),t.deleteRole(e).then(function(e){e.data;toastr.success(a.instant("common.successfullyDeletedMessage")),i()},function(e){t.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()})},e.dtOptions={id:"dtRoles",saveState:!0,allowFilter:!0,additionalSortFieldName:"id"},e.dtCols=[{name:"id",title:"common.id",allowSorting:!0,cellClass:"text-center",headerClass:"text-center"},{name:"roleName",title:"common.name",allowSorting:!0,cellClass:"text-center",headerClass:"text-center col-md-3"},{name:"roleTypeDesc",title:"common.description",allowSorting:!0,cellClass:"text-center",headerClass:"text-center col-md-3"},{name:"active",title:"common.status",allowSorting:!0,headerClass:"text-center col-md-1",cellClass:"text-center",cellTemplate:" <span class=\"label label-{{data.active ? 'success' : 'danger'}}\">{{data.active ? ('common.active' | translate) : ('common.inactive' | translate)}}</span>"},{name:"",title:"",allowSorting:!1,headerClass:"text-center col-md-2",cellClass:"tdcommand",cellTemplate:'<button class="btn btn-warning" ng-click="events.editRole(data);"\n               button-text="common.edit">\n          </button>          <button class="btn btn-danger" deletebutton \n               ng-click="events.deleteRole(data);" button-type="delete">          </button>'}],e.dtData=[],e.dtAdditionalData={shopCurrency:s.shopCurrency},e.dtEvents={editRole:function(t){e.editRole(t.id)},deleteRole:function(t){e.deleteRole(t.id)}}}]),angular.module("emixApp.controllers").controller("editrole_index",["$scope","httpServices","passObject","$rootScope","$filter","shareFunc","sharedInfo","$modalInstance","$translate",function(e,t,n,s,r,o,a,i,l){"use strict";e.showError=!1,e.showBreadcrump=!n,e.query="",e.roleTypeList=a.getRoleTypeList(),e.fileManagerActionObj={selected:[]},e.getFileManagerActions=function(){NProgress.start(),$.blockUI(),t.getFileManagerActions().then(function(t){var n=t.data;e.fileManagerActions=n.returnObject,e.getAllActivities()},function(e){t.handleError(e.data,e.status,e.headers,e.config),NProgress.done(),$.unblockUI()}).finally(function(){})},e.getFileManagerActions(),e.getAllActivities=function(){t.getAllActivities().then(function(t){var n=t.data;e.activities=n.returnObject,c()},function(e){t.handleError(e.data,e.status,e.headers,e.config),NProgress.done(),$.unblockUI()}).finally(function(){})},e.getRoleInfo=function(){t.getRoleInfo(n.roleId).then(function(t){var n=t.data;e.result={id:n.returnObject.id,name:n.returnObject.roleName,description:n.returnObject.description,defaultRole:n.returnObject.defaultRole,active:n.returnObject.active,roleType:n.returnObject.roleType,fileManagerActions:n.returnObject.fileManagerActions.map(function(e){return e.id}),activities:n.returnObject.activities.map(function(e){return e.id})}},function(e){t.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()})};var c=function(){!function(e,t){t?t.menuEntries=e:t=null;angular.forEach(e,function(e){!function e(t,n){t.parent=n;angular.forEach(t.menuEntries,function(n){e(n,t)})}(e,t||null)})}(e.activities,null),n.roleId>0?(e.editMode=!0,e.getRoleInfo()):(e.editMode=!1,e.result={name:"",description:"",defaultRole:!1,active:!0,roleType:e.roleTypeList[0].id,fileManagerActions:[],activities:[]},NProgress.done(),$.unblockUI())};e.ok=function(){e.editMode?e.editRole():e.createRole()},e.editRole=function(){e.showError=!0,e.myForm.$valid&&(NProgress.start(),$.blockUI(),t.editRole(e.result).then(function(t){t.data;toastr.success(l.instant("common.successfullySavedMessage")),a.setNeedRefresh(!0),setTimeout(e.closeModal(),1e3)},function(e){t.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()}))},e.createRole=function(){e.showError=!0,e.myForm.$valid&&(NProgress.start(),$.blockUI(),t.createRole(e.result).then(function(t){t.data;toastr.success(l.instant("common.successfullySavedMessage")),a.setNeedRefresh(!0),setTimeout(e.closeModal(),1e3)},function(e){t.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()}))};var d=function(t){var n=e.result.activities.indexOf(t.id);t.selected?-1===n&&e.result.activities.push(t.id):n>-1&&e.result.activities.splice(n,1)};e.changeAccess=function(e,t){e.selected=t,d(e),u(e,t),m(e)};var u=function(e,t){for(var n=0;n<e.menuEntries.length;n++)e.menuEntries[n].selected=t,d(e.menuEntries[n]),u(e.menuEntries[n],t)},m=function(e){var t=e.parent;if(t&&t.id>0){t.selected=!1;for(var n=0;n<t.menuEntries.length;n++)t.selected=t.selected||t.menuEntries[n].selected;d(t),m(t)}};e.setExpand=function(e){e.expand=!e.expand},e.initNode=function(t){t.expand=t.expand||!1,t.selected=e.result.activities.includes(t.id),t.hasAnyChild=t.menuEntries&&t.menuEntries.length>0},e.closeModal=function(){i.dismiss("cancel")}}]),angular.module("emixApp.controllers").controller("activitylist_index",["$scope","httpServices","PagerService","$rootScope","shareFunc","sharedInfo","$translate",function(e,t,n,s,r,o,a){"use strict";function i(){NProgress.start(),$.blockUI(),t.getAllActivities().then(function(t){var n=t.data;e.activities=n.returnObject,function(e,t){t?t.menuEntries=e:t=null;angular.forEach(e,function(e){!function e(t,n){t.parent=n;angular.forEach(t.menuEntries,function(n){e(n,t)})}(e,t||null)})}(e.activities,null)},function(e){t.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()})}e.query="",e.panelType="0",e.panelTypeFilter=function(t){var n=parseInt(e.panelType,10);return 0===n||t.panelType===n||3===n&&1!==t.panelType&&2!==t.panelType},i(),e.editActivity=function(e){var t={activityId:e};r.openModal(t,"/nimdalenap/home/ngApp/pages/account/activity/edit.html","editactivity_index",null,function(e){o.getNeedRefresh()&&i()},function(){o.getNeedRefresh()&&i()})},e.setExpand=function(e){e.expand=!e.expand},e.initNode=function(e){e.expand=e.expand||!1,e.hasAnyChild=e.menuEntries&&e.menuEntries.length>0}}]),angular.module("emixApp.controllers").controller("editactivity_index",["$scope","httpServices","passObject","$rootScope","$filter","shareFunc","sharedInfo","$modalInstance","$translate",function(e,t,n,s,r,o,a,i,l){"use strict";e.showError=!1,e.showBreadcrump=!n,e.query="",e.isLeftToRight=siteConfig.isLeftToRight,e.getAllPermissions=function(){NProgress.start(),$.blockUI(),t.getAllPermissions().then(function(t){var n=t.data;e.permissions=n.returnObject,e.getActivityInfo()},function(e){t.handleError(e.data,e.status,e.headers,e.config),NProgress.done(),$.unblockUI()}).finally(function(){})},e.getAllPermissions(),e.getActivityInfo=function(){t.getActivityInfo(n.activityId).then(function(t){var n=t.data;e.result={id:n.returnObject.id,title:n.returnObject.text,description:n.returnObject.description,permissions:n.returnObject.permissions.map(function(e){return e.id}),active:n.returnObject.active,icon:n.returnObject.icon,blank:n.returnObject.isBlank,modal:n.returnObject.isModal}},function(e){t.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()})},e.editActivity=function(){e.showError=!0,e.myForm.$valid&&(NProgress.start(),$.blockUI(),t.editActivity(e.result).then(function(t){t.data;toastr.success(l.instant("common.successfullySavedMessage")),a.setNeedRefresh(!0),setTimeout(e.closeModal(),1e3)},function(e){t.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()}))},e.closeModal=function(){i.dismiss("cancel")}}]),angular.module("emixApp.controllers").controller("siteusers_index",["$rootScope","$scope","httpServices","shareFunc","sharedInfo",function(e,t,n,s,r){"use strict";t.avatarUrl=Emix.Api.Account.image,t.userProfileUrl=Emix.Pages.userProfile,NProgress.start(),$.blockUI(),n.getAllUser().then(function(e){var n=e.data;t.dtData=n.returnObject},function(e){n.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()}),t.userDeviceList=function(e){var t={userId:e};s.openModal(t,"/nimdalenap/home/ngApp/pages/users/device-info-list.html","deviceinfolist_index","x-lg",function(e){},function(){})},t.dtOptions={id:"dtUserList",saveState:!0,allowFilter:!0,additionalSortFieldName:"id",apiUrl:Emix.Api.Users.getUsers},t.dtCols=[{name:"id",title:"common.id",allowSorting:!0,cellClass:"text-center",headerClass:"text-center tdmini"},{name:"logoPath",title:"common.image",allowSorting:!1,cellClass:"text-center",headerClass:"text-center col-md-1",filterable:!1,cellTemplate:'<img ng-src="{{additionalData.avatarUrl + data.logoPath }}" width="70" height="70" class="imglogo userimage img-circle" alt="User Avatar"\n                             id="userAvatar"/>'},{name:"username",title:"common.userName",allowSorting:!0,cellClass:"text-center",headerClass:"text-center col-md-1"},{name:"firstName",title:"common.name",allowSorting:!0,cellClass:"text-center",headerClass:"text-center col-md-2",cellTemplate:"",formatValue:function(e){return e||"--"},unFormatFilterText:function(e){return e.replaceAll("--","")}},{name:"lastName",title:"common.family",allowSorting:!0,cellClass:"text-center",headerClass:"text-center col-md-2",cellTemplate:"",formatValue:function(e){return e||"--"},unFormatFilterText:function(e){return e.replaceAll("--","")}},{name:"mobileNumber",title:"common.mobileNumber",allowSorting:!0,cellClass:"text-center",headerClass:"text-center col-md-1"},{name:"email",title:"common.email",allowSorting:!0,cellClass:"text-center",headerClass:"text-center col-md-2"},{name:"genderCaption",keyName:"gender",title:"common.gender",allowSorting:!0,cellClass:"text-center",headerClass:"text-center col-md-1",dataType:r.dataType.list,filterList:r.getGendersList(),filterListKey:"id",filterListValue:"name"},{name:"createDate",title:"common.saveDate",allowSorting:!0,cellClass:"text-center",headerClass:"text-center col-md-2",dataType:r.dataType.date},{name:"",title:"",allowSorting:!1,headerClass:"text-center tdmini",cellClass:"tdcommand",cellTemplate:'<a class="btn btn-success" ng-href="{{additionalData.userProfileUrl + \'/\' + data.id}}" button-type="edit"></a>\n<button class="btn btn-warning" ng-click="events.userDeviceList(data.id);"\n    button-text="common.deviceInfoList">\n</button>'}],t.dtData=[],t.dtAdditionalData={avatarUrl:t.avatarUrl,userProfileUrl:t.userProfileUrl},t.dtEvents={userDeviceList:function(e){t.userDeviceList(e)}}}]),angular.module("emixApp.controllers").controller("deviceinfolist_index",["$scope","httpServices","passObject","$modalInstance","$rootScope","shareFunc","sharedInfo","$translate",function(e,t,n,s,r,o,a,i){"use strict";function l(){NProgress.start(),$.blockUI(),t.getAllDeviceByUserId(n.userId).then(function(t){var n=t.data;e.dtData=n.returnObject},function(e){t.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()})}e.showError=!1,e.showBreadcrump=!n,l(),e.removeDevice=function(e){NProgress.start(),$.blockUI(),t.removeDevice(e).then(function(e){e.data;toastr.success(i.instant("common.successfullyDeletedMessage")),l()},function(e){t.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()})},e.dtOptions={id:"dtUserDeviceList",saveState:!1,allowFilter:!0,additionalSortFieldName:"id"},e.dtCols=[{name:"id",title:"common.id",allowSorting:!0,cellClass:"text-center",headerClass:"text-center"},{name:"deviceDetail",title:"common.details",allowSorting:!0,cellClass:"text-center",headerClass:"text-center col-md-3"},{name:"ip",title:"common.ip",allowSorting:!0,cellClass:"text-center",headerClass:"text-center col-md-2"},{name:"location",title:"common.location",allowSorting:!0,headerClass:"text-center col-md-2",cellClass:"text-center"},{name:"lastLoggedDate",title:"common.time",allowSorting:!0,headerClass:"text-center col-md-2",cellClass:"text-center"},{name:"",title:"",allowSorting:!1,headerClass:"text-center col-md-2",cellClass:"tdcommand",cellTemplate:'<button class="btn btn-danger" deletebutton \n               ng-click="events.delete(data);" button-type="delete">          </button>'}],e.dtData=[],e.dtAdditionalData={},e.dtEvents={delete:function(t){e.removeDevice(t.id)}}}]),angular.module("emixApp.controllers").controller("usergrouplist_index",["$scope","httpServices","PagerService","$rootScope","shareFunc","sharedInfo","$translate","$routeParams",function(e,t,n,s,r,o,a,i){"use strict";e.isAdminPanel="admin"===t.getPanelType(),e.getAllUserGroupsByUserId=function(){!e.isAdminPanel||e.userId&&0!==e.userId.length?(NProgress.start(),$.blockUI(),t.getAllUserGroupsByUserId(e.userId).then(function(t){var n=t.data;e.dtData=n.returnObject},function(e){t.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()})):e.dtData=[]},e.isAdminPanel||e.getAllUserGroupsByUserId(),e.deleteUserGroup=function(n){NProgress.start(),$.blockUI(),t.deleteUserGroup(n.id).then(function(t){toastr.success(a.instant("common.successfullyDeletedMessage")),e.getAllUserGroupsByUserId()},function(e){t.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()})},e.addEdit=function(t){var n={};t?n.id=t.id:(n.userId=e.userId,n.userName=e.selectedUser.username),r.openModal(n,"/nimdalenap/home/ngApp/pages/users/user-group/add.html","addusergroup_index","x-lg",function(t){e.getAllUserGroupsByUserId()},function(){o.getNeedRefresh()&&e.getAllUserGroupsByUserId()})},e.dbxUserOptions={id:"dbxCustomerClubUser",dataKeyField:"id",dataCodeField:"username",dataTextField:"firstName, lastName",label:"common.user",additionalSortFieldName:"id",apiUrl:e.isAdminPanel?Emix.Api.Users.getUsers:"",apiParams:{}},e.dbxUserCols=o.getDbxUserCols(),e.dbxUserEvents={onSelected:function(t){e.selectedUser=t,t&&(e.userId=t.id),e.getAllUserGroupsByUserId()}},e.userId="",e.selectedUser="",e.dtOptions={id:"dtUserGroups",saveState:!0,allowFilter:!0,additionalSortFieldName:"id"},e.dtCols=[{name:"id",title:"common.id",allowSorting:!0,cellClass:"text-center",headerClass:"text-center tdmini"},{name:"name",title:"common.name",allowSorting:!0,cellClass:"text-center",headerClass:"text-center col-md-8"},{name:"statusDesc",title:"common.status",allowSorting:!0,cellClass:"text-center",headerClass:"text-center col-md-2",cellTemplate:"<span class=\"label label-{{data.active ? 'success' : 'danger'}}\">{{data.active ? ('common.active' | translate) : ('common.inactive' | translate)}}</span>"},{name:"",title:"",allowSorting:!1,headerClass:"text-center tdmini",cellClass:"tdcommand",cellTemplate:'    <button class="btn btn-warning" ng-click="events.edit(data);"\n       button-type="edit">\n    </button>\n    <button class="btn btn-danger" ng-click="events.delete(data);"\n       button-type="delete">\n    </button>\n'}],e.dtData=[],e.dtAdditionalData={},e.dtEvents={edit:function(t){e.addEdit(t)},delete:function(t){e.deleteUserGroup(t)}}}]),angular.module("emixApp.controllers").controller("addusergroup_index",["$scope","httpServices","passObject","$rootScope","$filter","shareFunc","sharedInfo","$modalInstance","$translate","$timeout","$location",function(e,t,n,s,r,o,a,i,l,c,d){"use strict";e.isAdminPanel="admin"===t.getPanelType(),e.showError=!1,e.showBreadcrump=!n,e.deleteGroupMemberByUserName=function(s){NProgress.start(),$.blockUI(),t.deleteGroupMemberByUserName(n.id,s).then(function(t){toastr.success(l.instant("common.successfullyDeletedMessage")),e.getUserNamesByGroupId()},function(e){t.handleError(e.data,e.status,e.headers,e.config),NProgress.done(),$.unblockUI()}).finally(function(){})},e.addGroupMemberByUserName=function(){e.groupUserId&&e.groupUserId.toString().length>0?(NProgress.start(),$.blockUI(),t.addGroupMemberByUserId(n.id,e.groupUserId).then(function(t){toastr.success(l.instant("common.successfullySavedMessage")),e.dbxUserEvents.erase(),e.getUserNamesByGroupId()},function(e){t.handleError(e.data,e.status,e.headers,e.config),NProgress.done(),$.unblockUI()}).finally(function(){})):toastr.error(l.instant("validate.requiredMessage",{element:l.instant(e.isAdminPanel?"common.userName":"common.customer")}))};e.dbxUserOptions=e.isAdminPanel?{id:"dbxUserGroupEditUser",dataKeyField:"id",dataCodeField:"username",dataTextField:"firstName, lastName",label:"common.user",additionalSortFieldName:"id",apiUrl:Emix.Api.Users.getUsers,apiParams:{},readOnly:!0}:{id:"dbxUserGroupEditUser",dataKeyField:"customerUserId",dataCodeField:"maskCustomerUserName",dataTextField:"fullName",label:"common.customer",additionalSortFieldName:"customerUserId",apiUrl:Emix.Api.Application.merchant.getMerchantCustomers,apiParams:{},readOnly:!0},e.dbxUserCols=e.isAdminPanel?a.getDbxUserCols():a.getDbxMerchantUserCols(),e.dbxUserEvents={onSelected:function(t){e.selectedUser=t}},e.groupUserId=0,e.selectedUser="",e.getUserNamesByGroupId=function(){t.getUserNamesByGroupId(n.id).then(function(t){var n=t.data;e.dtData=n.returnObject},function(e){t.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()})},e.getUserGroupInfo=function(){NProgress.start(),$.blockUI(),t.getUserGroupInfo(n.id).then(function(t){var n=t.data;e.result={id:n.returnObject.id,name:n.returnObject.name,description:n.returnObject.description,active:n.returnObject.active},e.getUserNamesByGroupId()},function(e){t.handleError(e.data,e.status,e.headers,e.config),NProgress.done(),$.unblockUI()}).finally(function(){})},n&&n.id?(e.editMode=!0,e.getUserGroupInfo()):e.result={id:null,storeBranchId:null,userId:n.userId||"",userName:n.userName||"",name:"",description:"",active:!1},e.ok=function(){e.editMode?e.edit():e.create()},e.create=function(){e.showError=!0,e.myForm.$valid?(NProgress.start(),$.blockUI(),t.createUserGroup(e.result).then(function(t){t.data;a.setNeedRefresh(!0),setTimeout(e.closeModal(),1e3)},function(e){t.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()})):toastr.error(l.instant("common.completeFormCarefully"))},e.edit=function(){e.showError=!0,e.myForm.$valid&&(NProgress.start(),$.blockUI(),t.editUserGroup(e.result).then(function(e){e.data;toastr.success(l.instant("common.successfullySavedMessage")),a.setNeedRefresh(!0)},function(e){t.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()}))},e.dtOptions={id:"dtUserGroupUsers",pageSize:15,saveState:!0,allowFilter:!0,additionalSortFieldName:"id",rowClass:"col-md-2 col-sm-4 col-xs-6 pdr-0 pdl-5"},e.dtData=[],e.dtAdditionalData={},e.dtEvents={delete:function(t){e.deleteGroupMemberByUserName(t)}},e.closeModal=function(){i.dismiss("cancel")}}]);