angular.module("emixApp.controllers").controller("appAsideLte",["$scope","$location","$modal","sharedInfo","$rootScope","httpServices","$route","authService",function(e,t,o,n,i,a,r,s){"use strict";e.isLogin=s.isLoggedIn(),e.isMenuActive=function(e,o){return("#!"+t.path()).substring(0,o.length)===o},e.checkAndRedirect=function(e,o){("#!"+t.path()).substring(0,o.length)===o?r.reload():a.redirect(o)},e.showModal=function(e,t){e.isModal&&t.preventDefault(),setTimeout(u,100)},e.expandMenuItem=function(e){e.isModal?setTimeout(u,100):e.isGroup?(e.isExpanded=!e.isExpanded,setTimeout(c,100)):setTimeout(u,100)};var c=function(){$(".content-wrapper").css("min-height",$(".sidebar").height()+" !important")},u=function(){$(document).width()<748&&$(".sidebar-toggle").click()};i.$on("CallUpdateInfo",function(){e.updateInfo()}),i.$on("CallUpdateMenu",function(){e.updateMenu()}),e.updateInfo=function(){e.userInfo=n.getUserData(),e.userId=n.getUserId(),e.userPic=Emix.Api.Account.image+n.getUserLogoPath()},e.updateInfo(),e.menuEntries=[],e.updateMenu=function(){0==e.menuEntries.length&&a.isUserLogin(function(t){t&&(NProgress.start(),$.blockUI(),a.getPanelMenu().then(function(t){var o=t.data;e.menuEntries=o.returnObject},function(e){a.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()}))})},e.updateMenu()}]),angular.module("emixApp.controllers").controller("appHeader",["$scope","$window","$location","$translate","$timeout",function(e,t,o,n,i){"use strict";e.isMenuActive=function(e,t){return o.path().substring(0,t.length)===t},e.isLanguageActive=function(e){return e===n.use()},e.changeLanguage=function(e){n.storage().set(n.storageKey(),e),t.location.reload()}}]),angular.module("emixApp.controllers").controller("appHeaderLte",["$scope","$rootScope","httpServices","$window","$location","$translate","sharedInfo","$timeout","$cookies",function(e,t,o,n,i,a,r,s,c){"use strict";e.isLanguageActive=function(e){return e===a.use()},r.setLocaleLang(c.get(siteConfig.langCookieName)),t.$on("CallUpdateInfo",function(){e.updateInfo()}),e.updateInfo=function(){e.userInfo=r.getUserData(),e.todaylabel=r.getDate("longdate"),e.userId=r.getUserId(),e.userPic=Emix.Api.Account.image+r.getUserLogoPath()},e.updateInfo()}]),angular.module("emixApp.controllers").controller("confirmmodal_index",["$scope","httpServices","$modalInstance","passObject","$sce","$translate",function(e,t,o,n,i,a){"use strict";e.title=n.title,e.message=i.trustAsHtml(n.message),e.displayConfirmButton=!1!==n.displayConfirmButton,e.confirmText=n.confirmText?n.confirmText:a.instant("common.verify"),setTimeout(function(){n.actionToCall&&n.actionToCall()},2e3),e.confirm=function(){o.close(!0)},e.cancel=function(){o.dismiss("cancel")}}]),angular.module("emixApp.controllers").controller("promptmodal_index",["$scope","httpServices","$modalInstance","passObject","$sce","$translate",function(e,t,o,n,i,a){"use strict";e.title=n.title,e.message=i.trustAsHtml(n.message),e.confirmText=n.confirmText?n.confirmText:a.instant("common.verify"),e.inputCaption=n.inputCaption?n.inputCaption:"",e.inputType=n.inputType?n.inputType:"input",e.inputText=n.inputText||"",e.textareaText=n.inputText||"",e.required=n.required||!1,setTimeout(function(){n.actionToCall&&n.actionToCall()},2e3),e.getResult=function(){return"input"===e.inputType?e.inputText:e.textareaText},e.confirm=function(){var t=e.getResult();e.required&&0===t.length?toastr.error(a.instant("validate.requiredMessage",{element:e.inputCaption})):o.close(t)},e.cancel=function(){o.dismiss("cancel")}}]),angular.module("emixApp.controllers").controller("selectimage_index",["$rootScope","$scope","$timeout","Cropper","httpServices","$modal","passObject","$modalInstance","FileUploader","shareFunc","$q","$translate",function(e,t,o,n,i,a,r,s,c,u,l,p){"use strict";var d=r.formData,f=r.viewMode?r.viewMode:0;t.fixRatio=r.ratioWidth&&r.ratioHeight,t.config={freeCrop:!t.fixRatio},t.showRatio=!!r.showRatio&&r.showRatio,t.config.ratioWidth=t.fixRatio?r.ratioWidth:3,t.config.ratioHeight=t.fixRatio?r.ratioHeight:2,t.sendSize=!!r.sendSize&&r.sendSize,t.openSelectFile=function(e){o(function(){$("#uploaderImageSingle").trigger("click")},e=e||0)},s.opened.then(function(){T.clearQueue(),t.openSelectFile()});var g,h=function(e){return e.type.slice(e.type.lastIndexOf("/")+1).toLowerCase()},m=!1;t.DRAG_MODE_CROP="crop",t.DRAG_MODE_MOVE="move",t.DRAG_MODE_NONE="none",t.ZOOMIN=.1,t.ZOOMOUT=-.1,t.ROTATERIGHT=45,t.ROTATELEFT=-45,t.scaleXDefault=1,t.scaleYDefault=1,t.cropper={},t.cropperProxy="cropper.first",t.events={},t.ratioWidthChanged=function(e){m=!0,setTimeout(function(){t.$apply(function(){t.setAspectRation(t.config.ratioWidth,t.config.ratioHeight),I(),A()})},10)},t.ratioHeightChanged=function(e){m=!0,setTimeout(function(){t.$apply(function(){t.setAspectRation(t.config.ratioWidth,t.config.ratioHeight),I(),A()})},10)},t.freeCropChanged=function(){m=!0,setTimeout(function(){t.$apply(function(){t.setAspectRation(t.config.ratioWidth,t.config.ratioHeight),I(),A()})},10)};var v=!1;function A(){t.$broadcast(t.showEvent),setTimeout(function(){t.reset()},300)}function I(){t.$broadcast(t.hideEvent)}t.options={viewMode:f,maximize:!0,autoCropArea:1,zoomOnWheel:!1,crop:function(e){g=e,!1===m&&(t.config.ratioWidth=Math.round(g.detail.width),t.config.ratioHeight=Math.round(g.detail.height));var o=g.detail.width,n=g.detail.height,i={};r.ratioWidth&&o<r.ratioWidth&&(i.width=r.ratioWidth),r.ratioHeight&&n<r.ratioHeight&&(i.height=r.ratioHeight),(i.width||i.height)&&(v?v=!1:(v=!0,t.events.setData(i))),setTimeout(function(){m=!1},1e3)}},t.setAspectRation=function(e,o){t.config.freeCrop?(t.options.initialAspectRatio=e/o,t.options.aspectRatio=NaN):(t.options.aspectRatio=e/o,t.options.initialAspectRatio=NaN)},t.setAspectRation(t.config.ratioWidth,t.config.ratioHeight),t.showEvent="show",t.hideEvent="hide",t.options.dragMode=t.DRAG_MODE_MOVE,t.changeDragMode=function(e){t.options.dragMode=e},t.changeZoom=function(e){t.events.changeZoom(e)},t.rotate=function(e){t.events.rotate(e)},t.scaleX=function(){t.scaleXDefault=-1*t.scaleXDefault,t.events.scaleX(t.scaleXDefault)},t.scaleY=function(){t.scaleYDefault=-1*t.scaleYDefault,t.events.scaleY(t.scaleYDefault)},t.reset=function(){t.events.reset()},t.bgColorSettings={control:"hue",position:"top left"},t.bgColor="#fff",t.getCroppedCanvas=function(e){var o=t.bgColor;return"png"===h(e.file)&&(o="transparent"),t.events.getCroppedCanvas({fillColor:o})},t.uploadSuccess=function(e){s.close(e)},t.closeModal=function(){s.dismiss("cancel")},t.uploadImage=function(){1===T.queue.length?(NProgress.start(),$.blockUI(),T.uploadAll()):toastr.error("هیج فایلی انتخاب نشده")};var T=t.uploaderImageSingle=new c({queueLimit:2,url:r.uploadUrl});T.filters.push({name:"imageFilter",fn:function(e,t){var o="|"+h(e)+"|",n=-1!=="|jpeg|jpg|png|".indexOf(o);return n||toastr.error("شما فقط مجاز به انتخاب عکس با پسوند jpeg,jpg,png میباشید."),n}}),T.filters.push({name:"imageCountFilter",fn:function(e,t){var o=T.queue.length<=1;return o||toastr.error("حداکثر تعداد عکس مجاز ، 1 عدد می باشد. "),o}});var C=function(e,t){var o,n,i;(o=e.target.result,n=l.defer(),i=new Image,i.onload=function(){n.resolve({width:i.width,height:i.height})},i.src=o,n.promise).then(function(e){var o="";if(r.ratioWidth&&e.width<r.ratioWidth&&(o="عرض تصویر انتخابی "+e.width+" میباشد، حداقل عرض تصویر باید "+r.ratioWidth+" باشد."),r.ratioHeight&&e.height<r.ratioHeight&&(o+=(o.length>0?"<br />":"")+"ارتفاع تصویر انتخابی "+e.height+" میباشد، حداقل ارتفاع تصویر باید "+r.ratioHeight+" باشد."),o.length>0)throw toastr.error(o),T.clearQueue(),new Error(o);t()})};T.onAfterAddingFile=function(e){T.queue.length>1&&T.queue.shift(),e.croppedImage="";var n=new FileReader;n.onload=function(e){C(e,function(){t.dataUrl=e.target.result,I(),o(A)})},n.readAsDataURL(e._file)},T.onBeforeUploadItem=function(e){var o=t.getCroppedCanvas(e);if(o){var n="image/jpeg";"png"===h(e.file)&&(n="image/png");var a=u.dataURItoBlob(o.toDataURL(n,1));e._file=a,e.alias="image",e.formData=[],t.sendSize&&(d.width=t.config.ratioWidth,d.height=t.config.ratioHeight),e.formData.push(d),e.headers=i.addAuthHeader(e.headers)}else toastr.error("خطا در برش تصویر")},T.onSuccessItem=function(e,o,n,i){NProgress.done(),$.unblockUI(),toastr.success(p.instant("common.successfullySavedMessage")),t.uploadSuccess(o.returnObject)},T.onErrorItem=function(e,t,o,n){NProgress.done(),$.unblockUI(),e.isUploaded=!1;var i=t&&t.errorMessage?t.errorMessage:"در حین باگزاری عکس خطایی رخ داده است.لطفاً مجدد تلاش نمایید.";toastr.error(i)},T.onCompleteAll=function(){},t.$on("$destroy",function(){I()})}]);