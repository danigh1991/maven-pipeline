angular.module("emixApp.controllers").controller("login_index",["$http","$scope","$rootScope","httpServices","sharedInfo","$cookies","$location","$translate","$interval","$timeout","authService","shareFunc",function(e,t,s,r,n,o,a,i,d,l,c,u){"use strict";NProgress.done(),$.unblockUI(),t.title=new Date,t.userName="",t.password="",t.showError=!1;t.loginFormStatus="init",t.Timer=null;var m=function(){t.sendOtpButtonText=i.instant("login.sendOtp"),t.sendOtpButtonDisabled=!1,t.sendOtpButtonDisableTime=120};l(m(),100),t.nextFocus=function(e){document.getElementById(e).focus()},t.sendOtpCode=function(){if("password"!==t.loginFormStatus&&"otpPassword"!==t.loginFormStatus||t.password&&0!=t.password.trim().length){var e={userName:t.userName,password:t.password};t.send2faCode(e)}else toastr.error(i.instant("validate.requiredMessage",{element:i.instant("common.password")}))};var f=function(){t.sendOtpButtonDisableTime-=1,t.sendOtpButtonText=i.instant("login.sendOtp")+" "+t.sendOtpButtonDisableTime,t.sendOtpButtonDisableTime<=0&&(m(),angular.isDefined(t.Timer)&&d.cancel(t.Timer))};t.send2faCode=function(e){if(!t.myForm.$valid&&!e)return t.showError=!0,void toastr.error(i.instant("common.completeFormCarefully"));e||(e={userName:t.userName}),NProgress.start(),$.blockUI(),r.send2faCode(e).then(function(e){t.showError=!1,"uniqueCode"!=e.data.returnObject.status&&(t.loginFormStatus=e.data.returnObject.status,"sendverificationcode"!==t.loginFormStatus.toLowerCase()?(t.password="",l(function(){$("#password").focus()},500)):(toastr.success(e.data.returnObject.message),l(function(){$("#otp").focus()},500),function(e){if(e){var s=parseInt(e.remainTime,10);t.sendOtpButtonDisabled=s>0,t.sendOtpButtonDisableTime=s}}(e.data.returnObject),f(),angular.isDefined(t.Timer)&&d.cancel(t.Timer),t.Timer=d(function(){f()},1e3)))},function(e){r.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()})},t.login=function(){t.showError=!0,t.myForm.$valid?(NProgress.start(),$.blockUI(),r.login(t.userName,t.password,t.otp,"","","").then(function(e){var t=e.data;n.saveUserData(t.name+" "+t.family),n.saveUserId(t.userId),n.saveUserLogoPath(t.logoPath),c.setRefreshToken(t.refresh_token),c.setTokenInStorage(t.access_token),g()},function(e){r.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()})):toastr.error(i.instant("common.completeFormCarefully"))},t.backToUserName=function(){t.loginFormStatus="init",l(function(){$("#userName").focus()},500)},u.hideMenu();var g=function(){"admin"===r.getPanelType()?p():h()},p=function(){r.redirect(Emix.Pages.dashboard),u.showMenu()},h=function(){var e=$("div.navbar-login-box"),t="",s="";"advertise"===r.getProjectType()&&(s=((t=a.absUrl().split("/")[3]).length>0?"/":"")+t+Emix.Pages.sitePanelPage),s=e.length>0?(t.length>0?"/":"")+t+Emix.Pages.sitePanelPage:t+Emix.Pages.dashboard,r.redirect(s),u.showMenu(),window.location.reload()};r.checkIsLogin(function(){g()}),t.registershow=function(){r.registershow()}}]),angular.module("emixApp.controllers").controller("logout_index",["$scope","httpServices","$location","$timeout","authService",function(e,t,s,r,n){"use strict";e.logout=function(){NProgress.start(),$.blockUI(),t.logout().then(function(e){e.data;if(n.clearAllToken(),$("div.navbar-login-box").length>0&&"advertise"===t.getProjectType()){var o=s.absUrl().split("/")[3];t.redirect("/"+o+Emix.Pages.sitePanelPage)}else t.redirect(Emix.Pages.login);"panel"===t.getPanelType()&&r(function(){window.location.reload()},500)},function(e){t.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()})},e.logout()}]),angular.module("emixApp.controllers").controller("profile_index",["$scope","httpServices","$rootScope","sharedInfo","shareFunc","configService","$translate",function(e,t,s,r,n,o,a){"use strict";e.result="",e.configs={},o.then(function(t){e.configs=t}),e.userPic=Emix.Api.Account.image+r.getUserLogoPath(),e.gendersList=r.getGendersList(),e.projectType=t.getProjectType(),e.getUserInfo=function(){NProgress.start(),$.blockUI(),t.getUserInfo().then(function(t){var s=t.data;e.result=s.returnObject,e.diableAffiliateReagent=e.result.affiliateReagent&&e.result.affiliateReagent.length>0},function(e){t.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()})},e.getUserInfo(),e.updateUserInfo=function(){if(e.showError=!0,e.myForm.$valid){NProgress.start(),$.blockUI();var n={id:e.result.id,firstName:e.result.firstName,lastName:e.result.lastName,mobileNumber:e.result.mobileNumber,email:e.result.email,address:e.result.address,gender:e.result.gender,sendNotify:e.result.sendNotify,sendSms:e.result.sendSms,sendEmail:e.result.sendEmail,affiliateReagent:e.result.affiliateReagent};t.updateUserInfo(n).then(function(t){t.data;toastr.success(a.instant("common.successfullySavedMessage")),r.saveUserData(e.result.firstName+" "+e.result.lastName),s.$emit("CallUpdateInfo",{}),e.getUserInfo()},function(e){t.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()})}else toastr.error(a.instant("common.completeFormCarefully"))},e.changeUserAddress=function(){n.openModal({mode:1},"/panel/home/ngApp/pages/account/address/index.html","useraddresslist_index","x-lg",function(e){},function(){})},e.changeUserImage=function(){var t={formData:{id:e.result.id},ratioWidth:100,ratioHeight:100,uploadUrl:Emix.Api.Profile.uploadProfileImage};n.openModal(t,"/nimdalenap/home/ngApp/pages/application/common/image/index.html","selectimage_index","md",function(t){r.saveUserLogoPath(t),e.userPic=Emix.Api.Account.image+r.getUserLogoPath(),$("#userpic").attr("src",e.userPic),$("#userpic").attr("ng-src",e.userPic),$("#userpicheader").attr("src",e.userPic),$("#userpicheader").attr("ng-src",e.userPic)},function(){})}}]),angular.module("emixApp.controllers").controller("change_password_index",["$scope","httpServices","$routeParams","$translate","$timeout","shareFunc",function(e,t,s,r,n,o){"use strict";e.isReset="1"===s.isreset,t.getToken().then(function(e){o.showMenu()},function(e){405===e.status&&o.hideMenu()}),e.changePassword=function(){if(e.showError=!0,e.myForm.$valid)if(e.password===e.confirmPassword){NProgress.start(),$.blockUI();var s=void 0==e.oldpassword?"":e.oldpassword,o={newPassword:e.password,confirmNewPassword:e.confirmPassword,oldPassword:s};t.changePassword(o).then(function(s){s.data;toastr.success(r.instant("common.successfullySavedMessage")),e.password="",e.oldpassword="",e.confirmPassword="",e.showError=!1,t.redirectWithDelay(Emix.Pages.changePassword,100),n(function(){location.reload()},1e3)},function(e){t.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()})}else toastr.error(r.instant("login.dontMatch"));else toastr.error(r.instant("common.completeFormCarefully"))},e.checkPassword=function(){e.myForm.confirmPassword.$error.dontMatch=e.password!==e.confirmPassword}}]),angular.module("emixApp.controllers").controller("usergrouplist_index",["$scope","httpServices","PagerService","$rootScope","shareFunc","sharedInfo","$translate","$routeParams",function(e,t,s,r,n,o,a,i){"use strict";e.isAdminPanel="admin"===t.getPanelType(),e.getAllUserGroupsByUserId=function(){!e.isAdminPanel||e.userId&&0!==e.userId.length?(NProgress.start(),$.blockUI(),t.getAllUserGroupsByUserId(e.userId).then(function(t){var s=t.data;e.dtData=s.returnObject},function(e){t.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()})):e.dtData=[]},e.isAdminPanel||e.getAllUserGroupsByUserId(),e.deleteUserGroup=function(s){NProgress.start(),$.blockUI(),t.deleteUserGroup(s.id).then(function(t){toastr.success(a.instant("common.successfullyDeletedMessage")),e.getAllUserGroupsByUserId()},function(e){t.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()})},e.addEdit=function(t){var s={};t?s.id=t.id:(s.userId=e.userId,s.userName=e.selectedUser.username),n.openModal(s,"/nimdalenap/home/ngApp/pages/users/user-group/add.html","addusergroup_index","x-lg",function(t){e.getAllUserGroupsByUserId()},function(){o.getNeedRefresh()&&e.getAllUserGroupsByUserId()})},e.dbxUserOptions={id:"dbxCustomerClubUser",dataKeyField:"id",dataCodeField:"username",dataTextField:"firstName, lastName",label:"common.user",additionalSortFieldName:"id",apiUrl:e.isAdminPanel?Emix.Api.Users.getUsers:"",apiParams:{}},e.dbxUserCols=o.getDbxUserCols(),e.dbxUserEvents={onSelected:function(t){e.selectedUser=t,t&&(e.userId=t.id),e.getAllUserGroupsByUserId()}},e.userId="",e.selectedUser="",e.dtOptions={id:"dtUserGroups",saveState:!0,allowFilter:!0,additionalSortFieldName:"id"},e.dtCols=[{name:"id",title:"common.id",allowSorting:!0,cellClass:"text-center",headerClass:"text-center tdmini"},{name:"name",title:"common.name",allowSorting:!0,cellClass:"text-center",headerClass:"text-center col-md-8"},{name:"statusDesc",title:"common.status",allowSorting:!0,cellClass:"text-center",headerClass:"text-center col-md-2",cellTemplate:"<span class=\"label label-{{data.active ? 'success' : 'danger'}}\">{{data.active ? ('common.active' | translate) : ('common.inactive' | translate)}}</span>"},{name:"",title:"",allowSorting:!1,headerClass:"text-center tdmini",cellClass:"tdcommand",cellTemplate:'    <button class="btn btn-warning" ng-click="events.edit(data);"\n       button-type="edit">\n    </button>\n    <button class="btn btn-danger" ng-click="events.delete(data);"\n       button-type="delete">\n    </button>\n'}],e.dtData=[],e.dtAdditionalData={},e.dtEvents={edit:function(t){e.addEdit(t)},delete:function(t){e.deleteUserGroup(t)}}}]),angular.module("emixApp.controllers").controller("addusergroup_index",["$scope","httpServices","passObject","$rootScope","$filter","shareFunc","sharedInfo","$modalInstance","$translate","$timeout","$location",function(e,t,s,r,n,o,a,i,d,l,c){"use strict";e.isAdminPanel="admin"===t.getPanelType(),e.showError=!1,e.showBreadcrump=!s,e.deleteGroupMemberByUserName=function(r){NProgress.start(),$.blockUI(),t.deleteGroupMemberByUserName(s.id,r).then(function(t){toastr.success(d.instant("common.successfullyDeletedMessage")),e.getUserNamesByGroupId()},function(e){t.handleError(e.data,e.status,e.headers,e.config),NProgress.done(),$.unblockUI()}).finally(function(){})},e.addGroupMemberByUserName=function(){e.groupUserId&&e.groupUserId.toString().length>0?(NProgress.start(),$.blockUI(),t.addGroupMemberByUserId(s.id,e.groupUserId).then(function(t){toastr.success(d.instant("common.successfullySavedMessage")),e.dbxUserEvents.erase(),e.getUserNamesByGroupId()},function(e){t.handleError(e.data,e.status,e.headers,e.config),NProgress.done(),$.unblockUI()}).finally(function(){})):toastr.error(d.instant("validate.requiredMessage",{element:d.instant(e.isAdminPanel?"common.userName":"common.customer")}))};e.dbxUserOptions=e.isAdminPanel?{id:"dbxUserGroupEditUser",dataKeyField:"id",dataCodeField:"username",dataTextField:"firstName, lastName",label:"common.user",additionalSortFieldName:"id",apiUrl:Emix.Api.Users.getUsers,apiParams:{},readOnly:!0}:{id:"dbxUserGroupEditUser",dataKeyField:"customerUserId",dataCodeField:"maskCustomerUserName",dataTextField:"fullName",label:"common.customer",additionalSortFieldName:"customerUserId",apiUrl:Emix.Api.Application.merchant.getMerchantCustomers,apiParams:{},readOnly:!0},e.dbxUserCols=e.isAdminPanel?a.getDbxUserCols():a.getDbxMerchantUserCols(),e.dbxUserEvents={onSelected:function(t){e.selectedUser=t}},e.groupUserId=0,e.selectedUser="",e.getUserNamesByGroupId=function(){t.getUserNamesByGroupId(s.id).then(function(t){var s=t.data;e.dtData=s.returnObject},function(e){t.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()})},e.getUserGroupInfo=function(){NProgress.start(),$.blockUI(),t.getUserGroupInfo(s.id).then(function(t){var s=t.data;e.result={id:s.returnObject.id,name:s.returnObject.name,description:s.returnObject.description,active:s.returnObject.active},e.getUserNamesByGroupId()},function(e){t.handleError(e.data,e.status,e.headers,e.config),NProgress.done(),$.unblockUI()}).finally(function(){})},s&&s.id?(e.editMode=!0,e.getUserGroupInfo()):e.result={id:null,storeBranchId:null,userId:s.userId||"",userName:s.userName||"",name:"",description:"",active:!1},e.ok=function(){e.editMode?e.edit():e.create()},e.create=function(){e.showError=!0,e.myForm.$valid?(NProgress.start(),$.blockUI(),t.createUserGroup(e.result).then(function(t){t.data;a.setNeedRefresh(!0),setTimeout(e.closeModal(),1e3)},function(e){t.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()})):toastr.error(d.instant("common.completeFormCarefully"))},e.edit=function(){e.showError=!0,e.myForm.$valid&&(NProgress.start(),$.blockUI(),t.editUserGroup(e.result).then(function(e){e.data;toastr.success(d.instant("common.successfullySavedMessage")),a.setNeedRefresh(!0)},function(e){t.handleError(e.data,e.status,e.headers,e.config)}).finally(function(){NProgress.done(),$.unblockUI()}))},e.dtOptions={id:"dtUserGroupUsers",pageSize:15,saveState:!0,allowFilter:!0,additionalSortFieldName:"id",rowClass:"col-md-2 col-sm-4 col-xs-6 pdr-0 pdl-5"},e.dtData=[],e.dtAdditionalData={},e.dtEvents={delete:function(t){e.deleteGroupMemberByUserName(t)}},e.closeModal=function(){i.dismiss("cancel")}}]);